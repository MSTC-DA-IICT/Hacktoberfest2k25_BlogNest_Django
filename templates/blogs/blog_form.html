{% extends 'base.html' %} {% load static %} {% block title %} {% if
form.instance.pk %}Edit Blog Post{% else %}Create New Blog Post{% endif %} -
BlogNest {% endblock %} {% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h3 class="card-title mb-0">
            <i class="fas fa-edit"></i>
            {% if form.instance.pk %}Edit Blog Post{% else %}Create New Blog
            Post{% endif %}
          </h3>
        </div>
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            <!-- Display form errors at the top -->
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
              <ul class="mb-0">
                {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
            {% endif %}

            <!-- Blog Title -->
            <div class="mb-3">
              <label for="{{ form.title.id_for_label }}" class="form-label">
                <strong>{{ form.title.label }}</strong>
                {% if form.title.field.required %}<span class="text-danger"
                  >*</span
                >{% endif %}
              </label>
              {{ form.title }} {% if form.title.help_text %}
              <div class="form-text">{{ form.title.help_text }}</div>
              {% endif %} {% if form.title.errors %}
              <div class="text-danger small mt-1">
                {% for error in form.title.errors %}
                <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Blog Excerpt -->
            <div class="mb-3">
              <label for="{{ form.excerpt.id_for_label }}" class="form-label">
                <strong>{{ form.excerpt.label }}</strong>
              </label>
              {{ form.excerpt }} {% if form.excerpt.help_text %}
              <div class="form-text">{{ form.excerpt.help_text }}</div>
              {% endif %} {% if form.excerpt.errors %}
              <div class="text-danger small mt-1">
                {% for error in form.excerpt.errors %}
                <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Blog Content -->
            <div class="mb-3">
              <label for="{{ form.content.id_for_label }}" class="form-label">
                <strong>{{ form.content.label }}</strong>
                {% if form.content.field.required %}<span class="text-danger"
                  >*</span
                >{% endif %}
              </label>
              {{ form.content }} {% if form.content.help_text %}
              <div class="form-text">{{ form.content.help_text }}</div>
              {% endif %} {% if form.content.errors %}
              <div class="text-danger small mt-1">
                {% for error in form.content.errors %}
                <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Tags -->
            <div class="mb-3">
              <label for="{{ form.tags.id_for_label }}" class="form-label">
                <strong>{{ form.tags.label }}</strong>
              </label>
              {{ form.tags }} {% if form.tags.help_text %}
              <div class="form-text">{{ form.tags.help_text }}</div>
              {% endif %} {% if form.tags.errors %}
              <div class="text-danger small mt-1">
                {% for error in form.tags.errors %}
                <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Publish Status -->
            <div class="mb-4">
              <label for="{{ form.status.id_for_label }}" class="form-label">
                <strong>{{ form.status.label }}</strong>
                {% if form.status.field.required %}<span class="text-danger"
                  >*</span
                >{% endif %}
              </label>
              {{ form.status }} {% if form.status.help_text %}
              <div class="form-text">{{ form.status.help_text }}</div>
              {% endif %} {% if form.status.errors %}
              <div class="text-danger small mt-1">
                {% for error in form.status.errors %}
                <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-between align-items-center">
              <a href="{% url 'blogs:home' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Cancel
              </a>
              <div>
                {% if form.instance.pk %}
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-save"></i> Update Blog Post
                </button>
                {% else %}
                <button
                  type="submit"
                  name="save_draft"
                  class="btn btn-outline-primary me-2"
                >
                  <i class="fas fa-file-alt"></i> Save as Draft
                </button>
                <button type="submit" name="publish" class="btn btn-success">
                  <i class="fas fa-paper-plane"></i> Publish Blog
                </button>
                {% endif %}
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Writing Tips Card -->
      <div class="card mt-4">
        <div class="card-header bg-info text-white">
          <h5 class="card-title mb-0">
            <i class="fas fa-lightbulb"></i> Writing Tips
          </h5>
        </div>
        <div class="card-body">
          <ul class="mb-0">
            <li>
              <strong>Title:</strong> Make it catchy and descriptive to grab
              readers' attention
            </li>
            <li>
              <strong>Excerpt:</strong> Write a compelling summary that
              encourages readers to continue
            </li>
            <li>
              <strong>Content:</strong> Structure your content with headings,
              paragraphs, and bullet points
            </li>
            <li>
              <strong>Tags:</strong> Use relevant keywords to help readers
              discover your post
            </li>
            <li>
              <strong>Draft vs Publish:</strong> Save as draft to work on later,
              or publish immediately
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom CSS for form styling -->
<style>
  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
  }

  .form-label {
    color: #495057;
    font-weight: 600;
  }

  .form-text {
    color: #6c757d;
    font-size: 0.875em;
  }

  .card {
    border: none;
    border-radius: 10px;
  }

  .card-header {
    border-radius: 10px 10px 0 0 !important;
    border-bottom: none;
  }

  .btn {
    border-radius: 6px;
    font-weight: 500;
  }

  .text-danger {
    color: #dc3545 !important;
  }

  .alert {
    border-radius: 8px;
    border: none;
  }
</style>

<!-- JavaScript for enhanced form functionality -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Auto-resize textarea for content field
    const contentTextarea = document.getElementById(
      "{{ form.content.id_for_label }}"
    );
    if (contentTextarea) {
      contentTextarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });
    }

    // Character counter for title and excerpt
    function addCharacterCounter(fieldId, maxLength) {
      const field = document.getElementById(fieldId);
      if (field) {
        const counter = document.createElement("small");
        counter.className = "form-text text-muted";
        counter.style.float = "right";

        function updateCounter() {
          const remaining = maxLength - field.value.length;
          counter.textContent = `${field.value.length}/${maxLength} characters`;
          counter.style.color = remaining < 50 ? "#dc3545" : "#6c757d";
        }

        field.parentNode.appendChild(counter);
        field.addEventListener("input", updateCounter);
        updateCounter();
      }
    }

    addCharacterCounter("{{ form.title.id_for_label }}", 200);
    addCharacterCounter("{{ form.excerpt.id_for_label }}", 300);

    // Form validation feedback
    const form = document.querySelector("form");
    if (form) {
      form.addEventListener("submit", function (e) {
        const requiredFields = form.querySelectorAll("[required]");
        let isValid = true;

        requiredFields.forEach(function (field) {
          if (!field.value.trim()) {
            field.classList.add("is-invalid");
            isValid = false;
          } else {
            field.classList.remove("is-invalid");
          }
        });

        if (!isValid) {
          e.preventDefault();
          alert("Please fill in all required fields.");
        }
      });
    }
  });
</script>
{% endblock %}
